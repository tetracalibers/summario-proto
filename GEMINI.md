## アプリケーション概要

- **名称:** Summario
- **コンセプト:** 要約して作る自分だけの用語集。
- **想定ユースケース:**
  - 書籍や学習コンテンツの専門用語を自分なりにまとめて管理する。
  - 技術やコードスニペットの用途や知見を整理する。

## 機能要件

### 用語ノート管理 (CRUD)

- 用語ノートの追加、編集、削除ができる。
- 1つの用語ノートは｢タイトル｣｢コンテンツ｣｢エイリアス（複数）｣｢所属フォルダ｣をデータとして持つ。

### 検索機能

- 登録した用語をキーワードで検索できる。
- 検索キーワードとして「タイトル」と「エイリアス」を使用できる。

### フォルダ機能

- フォルダを作成し、用語を分類できる。
- フォルダはネスト（階層化）が可能。
- データベース上ではフォルダの階層構造をAdjacency List Modelで表現する。
- クエリではRecursive Common Table Expressionを積極的に用いる。

### 関連用語機能

- 用語同士を相互に関連付けることができる（双方向リレーション）。
- UI上では、既存の登録済み用語のみを関連付けの候補として提示する。

## 非機能要件

### 技術スタック

- **フルスタックフレームワーク:** React Router（framework mode）
- **言語:** TypeScript
- **バックエンド:** Supabase
- **ORM:** Drizzle
- **データベース:** PostgreSQL
- **UIコンポーネント:** Mantine
- **スタイリング:** Mantine + CSS Modules
- **ブロックエディタ:** Tiptap

### 開発環境

- **データベース構築:** Docker (docker-compose) を使用してローカルにSupabase環境を構築する。

### アーキテクチャモデル

次のアーキテクチャに従って開発を行う。

1. ユーザーが UI（例：フォーム入力、ページ遷移）を操作
2. React Router が該当ルートの loader（GET）または action（POST/更新系）を呼出
3. loader／action は、必要な入力チェック・バリデーションを経た後、サービス層を呼び出す
4. サービス層でビジネスロジックを実行、必要に応じて複数のリポジトリ層を呼び出す
5. リポジトリ層が ORM／データベースアクセスを行い、データを取得・保存
6. 処理結果やエラーをコントローラー層で受け、適切に整形して UI 層に返却
7. UI 層は返ってきたデータを表示、またはユーザーインタラクションを受け取る

| 層                    | 相当する役割／ファイル                                     | 主な責務                                          | 特徴／メリット                                                                                                           |
| -------------------- | ----------------------------------------------- | --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| **UI 層（プレゼンテーション層）** | React コンポーネント（Page／子コンポーネント群）                   | ユーザーへの表示、入力受け取り                               | React 標準的な設計。`useLoaderData()` によって、子コンポーネントは親経由で渡されたデータを受け取れる。プロップドリリングやグローバルステート管理を最小化できる。 |
| **コントローラー層**         | ルートモジュール（例：`route.tsx`）                         | UI からの入力処理、バリデーション、サービス層の呼び出し、エラー処理、UI への結果返却 | `loader`／`action` 関数を使い、HTTP リクエスト的な振る舞いをコントロールする。UI とビジネスロジックの仲介役。 |
| **サービス層（ビジネスロジック層）** | Service クラス（例：`LoaderService`, `ActionService`） | ドメインロジック、複数リポジトリの組み合わせ、トランザクション管理など           | コントローラー層はサービス層を呼んで「何をするか」を指示する。サービス層は「どう実装するか」に集中できるように分離。 |
| **リポジトリ層（データアクセス層）** | ORM をラップするリポジトリクラス                           | DB への CRUD 処理、ORM のラッピング、クエリ定義                | リポジトリ経由でデータを扱うことで、サービス層と ORMとの結合を緩め、将来 ORM を変える際の影響を抑えられる。またテスト容易性も向上。|
